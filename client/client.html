<html>

<head>
    <title>Personal Soundtrack</title>
    <link rel="preconnect" href="https://fonts.gstatic.com">
    <link href="https://fonts.googleapis.com/css2?family=PT+Sans:wght@700&family=Raleway:wght@200&display=swap" rel="stylesheet"> 
    <link href="default-styles.css" type="text/css" rel="stylesheet" />
</head>

<body>
    <header>
        <h1>Personal Soundtrack</h1>
        <nav>
            <a href="/home.html">Home</a>
            <a href="/client.html">App</a>
            <a href="/suggest.html">Suggest</a>
            <a href="/admin.html">Admin</a>
        </nav>
    </header>

    <main>
        <span id="timeSpan"></span>
        <span id="nowPlaying">Now Playing: Test Song</span>
        <img class="backgroundElement" id="sun" src="/images/sun">
        <img class="backgroundElement" id="moon" src="/images/moon">
        <audio id="musicPlayer">
            <source src="/music/test.mp3" type="audio/mpeg">
            Your browser does not support the audio tag.
        </audio>
        <div id="musicControls">
            <img id="playButton" src="/images/play">
            <img id="pauseButton" src="/images/pause">
            <div id="progressBar">
                <div id="progressFill"></div>
                <img src="/images/circle">
            </div>
            <img id="volumeImg" src="/images/audioOn">
            <div id="volumeBar">
                <div id="volumeFill"></div>
                <img src="/images/circle">
            </div>
        </div>
    </main>
    <footer>
        <p>by Jimmie Harkins</p>
    </footer>
    <script src='visual-effects.js'></script>
    <script>
        const timeSpan = document.querySelector("#timeSpan");
        const musicPlayer = document.querySelector("#musicPlayer");
        const musicSource = document.querySelector("#musicPlayer source");
        const playButton = document.querySelector("#playButton");
        const pauseButton = document.querySelector("#pauseButton");
        const progressFill = document.querySelector("#progressFill");
        const progressImage = document.querySelector("#progressBar img");
        const volumeBar = document.querySelector("#volumeBar");
        const volumeFill = document.querySelector("#volumeFill");
        const volumeKnob = document.querySelector("#volumeBar img");
        const songs = ["test", "paper-tigers", "west-coast-friendship"];
        let songIndex = 0;
        const updateTime = () => {
            const currentTime = new Date();
            const hours = currentTime.getHours();
            let minutes = currentTime.getMinutes();
            setVisualTime(hours + minutes / 60);
            if(minutes < 10) {
                minutes = "0" + minutes;
            }
            //creative use of ternary, if hours % 12 is 0, show 12 instead of 0
            let timeString = (hours % 12 ? hours % 12 : 12) + ":" + minutes + " ";
            if(hours > 11) {
                timeString += "PM";
            } else {
                timeString += "AM";
            }
            timeSpan.innerHTML = timeString;
        }
        const switchAudio = (e) => {
            songIndex++;
            musicSource.src = "/music/" + songs[songIndex % songs.length] + ".mp3";
            musicPlayer.load();
            musicPlayer.currentTime = 0;
        }
        musicPlayer.addEventListener('ended', switchAudio);
        musicPlayer.addEventListener('timeupdate', (e) => {
            const progressPercent = musicPlayer.currentTime / musicPlayer.duration;
            progressFill.style.width = `${progressPercent * 100}%`;
            progressImage.style.left = `${progressPercent * 100}%`;
        })
        playButton.addEventListener('click', () => {
            musicPlayer.play();
            pauseButton.style.display = "block";
            playButton.style.display = "none";
        });
        pauseButton.addEventListener('click', () => {
            musicPlayer.pause();
            pauseButton.style.display = "none";
            playButton.style.display = "block";
        });
        let volumeFollow = false;
        volumeKnob.addEventListener('mousedown', (e) => {
            e.preventDefault();
            volumeFollow = true;
        });
        volumeKnob.addEventListener('mousemove', (e) => {
            if(volumeFollow) {
                console.log(e.offsetX);
                const bounds = volumeBar.getBoundingClientRect();
                volumeKnob.style.left = e.clientX - bounds.left;
            }
        })
        document.addEventListener('mouseup', () => {
            volumeFollow = false;
        });
        updateTime();
        setInterval(updateTime, 1000);
    </script>
</body>

</html>